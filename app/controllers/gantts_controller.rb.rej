***************
*** 33,36 ****
      show
    end
  
  end
--- 33,66 ----
      show
    end
  
+   def edit_gantt
+     date_from = Date.parse(params[:date_from])
+     date_to = Date.parse(params[:date_to])
+     months = date_to.month - date_from.month + 1
+     params[:year] = date_from.year
+     params[:month] = date_from.month
+     params[:months] = months
+     @gantt = Redmine::Helpers::Gantt.new(params)
+     @gantt.project = @project
+     text, status = @gantt.edit(params)
+     render :text=>text, :status=>status
+   end
+ 
+   def find_optional_project
+     begin
+       if params[:action] && params[:action].to_s == "edit_gantt"
+         @project = Project.find(params[:project_id]) unless params[:project_id].blank?
+         allowed = User.current.allowed_to?(:edit_issues, @project, :global => true)
+         if allowed
+           return true
+         else
+           render :text=>"lack of permission to edit issues", :status=>403
+         end
+       else
+         super
+       end
+     rescue => e
+       return e.to_s + "\n===\n" + [$!,$@.join("\n")].join("\n")
+     end
+   end
  end
